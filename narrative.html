<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Atlas Narrative â€” Daily Risk Posture</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css" />

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VSTQ6CXJ4C"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-VSTQ6CXJ4C');
    </script>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2505573687893335"
     crossorigin="anonymous"></script>

</head>

<body class="bg-gray-50 text-gray-800 antialiased">

    <header class="fixed top-0 w-full z-50 bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-14 relative">

                <a href="/" class="flex-shrink-0 flex flex-col items-start justify-center h-full">
                    <div class="flex items-center">
                        <svg class="w-6 h-6 mr-2 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke-width="2" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 2a15.3 15.3 0 0110 10M2 12a15.3 15.3 0 0010 10M2 12h20" />
                            <rect x="7" y="14" width="2" height="4" rx="1" fill="currentColor" />
                            <rect x="11" y="12" width="2" height="6" rx="1" fill="currentColor" />
                            <rect x="15" y="15" width="2" height="3" rx="1" fill="currentColor" />
                        </svg>
                        <span class="font-extrabold text-xl tracking-wide text-gray-900">
                            Atlas<span class="text-indigo-600">Dashboard</span>
                        </span>
                    </div>
                </a>

                <div class="flex space-x-6 h-full">

                    <a href="/" class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-900 
                              border-b-2 border-transparent hover:border-indigo-600 transition duration-150 ease-in-out">
                        Dashboard
                    </a>
                    
                    <a href="narrative.html" class="flex items-center text-sm font-bold text-gray-900 
                              border-b-2 border-indigo-600 transition duration-150 ease-in-out">
                        Narrative
                    </a>

                    <a href="archive.html" class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-900 
                              border-b-2 border-transparent hover:border-indigo-600 transition duration-150 ease-in-out">
                        Archive
                    </a>
                </div>

                <div class="flex items-center">
                    <div id="bannerBadge" class="self-start sm:self-center">
                    </div>
                </div>
            </div>
        </div>
    </header>
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 pt-20 pb-14">
        <header class="mb-8 pb-4 border-b border-gray-200">
            <h1 id="narrativeTitle" class="text-3xl font-extrabold text-gray-900">Risk Posture Analysis</h1>
            <p id="narrativeDate" class="text-sm text-gray-500 mt-1">Updated: Loading...</p>
            <span id="narrativeStatusBadge" class="mt-4 inline-block px-3 py-1 text-sm font-bold rounded-full text-white bg-gray-400">Loading Status</span>
        </header>

        <main id="fullNarrativeContent" class="bg-white rounded-xl shadow p-6 lg:p-8 text-lg text-gray-700 leading-relaxed">
            <p>Loading the daily analysis...</p>
        </main>
    </div>

    <nav class="fixed bottom-0 w-full z-50 bg-white shadow-top">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-12 text-xs text-gray-500">
                
                <div class="hidden sm:block">
                    Disclaimer: Not financial advice. Data for informational purposes only. Not financial advice.
                </div>
                
                <div class="flex items-center space-x-4">
                    <button id="copyShareLink" class="text-indigo-600 hover:text-indigo-800 font-medium transition duration-150 ease-in-out flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.935 9 12.49 9 12c0-.51-.114-.955-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l-3 3m3-3l3-3m-9 3a3 3 0 110-2.684m0 2.684l-3-3m3 3l3-3m9-2c0 .51-.114.955-.316 1.342m0-2.684a3 3 0 100 2.684m0 2.684l-3 3m3-3l3-3m-9-2a3 3 0 100 2.684m0-2.684a3 3 0 110 2.684m0 2.684l-3 3m3-3l3-3"/>
                        </svg>
                        Copy Share Link
                    </button>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=YOUR_URL_GOES_HERE" target="_blank" class="hover:text-gray-800 hidden md:block">Facebook</a>
                    <a href="https://twitter.com/intent/tweet?url=YOUR_URL_GOES_HERE" target="_blank" class="hover:text-gray-800 hidden md:block">Twitter</a>
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url=YOUR_URL_GOES_HERE" target="_blank" class="hover:text-gray-800 hidden md:block">LinkedIn</a>
                </div>
            </div>
        </div>
    </nav>
    <script src="scripts/atlas.js" defer></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            function updateNarrativePage() {
                // The AI-generated analysis is stored in data/atlas-latest.json
                fetch('data/atlas-latest.json')
                    .then(response => response.json())
                    .then(data => {
                        const narrativeContainer = document.getElementById('fullNarrativeContent');
                        const dateElement = document.getElementById('narrativeDate');
                        const statusBadge = document.getElementById('narrativeStatusBadge');
                        
                        const overall = data.overall;

                        if (overall && overall.daily_narrative) {
                            // 1. Inject the AI Commentary
                            // Replace newline characters (\n) with HTML line breaks (<br><br>)
                            const formattedNarrative = overall.daily_narrative.replace(/\n/g, '<br><br>');
                            narrativeContainer.innerHTML = formattedNarrative;

                            // 2. Update Header Information
                            dateElement.textContent = `Updated: ${overall.date}`;
                            statusBadge.textContent = overall.status;

                            // 3. Update the badge color based on status (Optional, but good practice)
                            const statusText = overall.status.toUpperCase();
                            statusBadge.classList.remove('bg-gray-400', 'bg-green-500', 'bg-yellow-500', 'bg-orange-500', 'bg-red-600');
                            
                            if (statusText.includes('FULL-STORM')) {
                                statusBadge.classList.add('bg-red-600');
                            } else if (statusText.includes('SEVERE')) {
                                statusBadge.classList.add('bg-orange-500');
                            } else if (statusText.includes('ELEVATED')) {
                                statusBadge.classList.add('bg-yellow-500');
                            } else {
                                statusBadge.classList.add('bg-green-500');
                            }

                        } else {
                            narrativeContainer.innerHTML = '<p>AI analysis unavailable or JSON data missing. Check if the Python script ran successfully.</p>';
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching Atlas data:', error);
                        document.getElementById('fullNarrativeContent').innerHTML = '<p>Failed to load dynamic commentary. Check file path.</p>';
                    });
            }

            // Run the function on page load
            updateNarrativePage();
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const copyButton = document.getElementById('copyShareLink');
            
            if (copyButton) {
                copyButton.addEventListener('click', async () => {
                    const shareUrl = window.location.href; // Gets the full current URL
                    
                    try {
                        // Use the modern clipboard API
                        await navigator.clipboard.writeText(shareUrl);
                        
                        // Give the user visual feedback
                        const originalText = copyButton.innerHTML;
                        copyButton.innerHTML = '<span class="text-green-600">Copied!</span>';
                        
                        // Revert the button text after a short delay
                        setTimeout(() => {
                            copyButton.innerHTML = originalText;
                        }, 2000);
                        
                    } catch (err) {
                        console.error('Failed to copy text: ', err);
                        // Fallback method for older browsers (less reliable)
                        prompt('Copy this link:', shareUrl); 
                    }
                });
            }

            // Also update the social sharing links dynamically
            const currentUrl = encodeURIComponent(window.location.href);
            
            document.querySelectorAll('a[href*="YOUR_URL_GOES_HERE"]').forEach(link => {
                let href = link.getAttribute('href');
                href = href.replace('YOUR_URL_GOES_HERE', currentUrl);
                link.setAttribute('href', href);
            });
        });
    </script>
</body>

</html>